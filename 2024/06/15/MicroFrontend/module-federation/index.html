<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="前言当项目A需要共享项目B的某一个组件，并需要保证后续的迭代中，两边保持一致。这个时候有两种做法： CV 大法，将项目B的组件完整复制到项目A将该组件独立，发布到内部npm，通过npm加载组件 CV 大法比独立组件更快，不需要将组件从项目B独立出来，发布npm，但不能及时同步代码。当两个项目都使用了Webpack5，通过联邦模块只需要几行配置就可以实现在项目A同步项目B的组件。 一.什么是联邦模块">
<meta property="og:type" content="article">
<meta property="og:title" content="模块联邦 远程载入">
<meta property="og:url" content="https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/index.html">
<meta property="og:site_name" content="Liu">
<meta property="og:description" content="前言当项目A需要共享项目B的某一个组件，并需要保证后续的迭代中，两边保持一致。这个时候有两种做法： CV 大法，将项目B的组件完整复制到项目A将该组件独立，发布到内部npm，通过npm加载组件 CV 大法比独立组件更快，不需要将组件从项目B独立出来，发布npm，但不能及时同步代码。当两个项目都使用了Webpack5，通过联邦模块只需要几行配置就可以实现在项目A同步项目B的组件。 一.什么是联邦模块">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-06-15T11:25:25.000Z">
<meta property="article:modified_time" content="2024-10-09T10:45:07.383Z">
<meta property="article:author" content="Codcer">
<meta property="article:tag" content="微前端">
<meta property="article:tag" content="MicroFrontend">
<meta property="article:tag" content="前端全栈">
<meta name="twitter:card" content="summary">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>
       
        模块联邦 远程载入 | 前端全栈! - WEB BANG! BANG!! BANG!!!
      
    </title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/codcer">Github</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2024/09/15/CICD/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%20-%20%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E6%89%AB%E6%8F%8F%E7%AF%87/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2024/03/01/source/Fiber%E6%9E%B6%E6%9E%84/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&text=模块联邦 远程载入"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&title=模块联邦 远程载入"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&is_video=false&description=模块联邦 远程载入"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=模块联邦 远程载入&body=Check out this article: https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&title=模块联邦 远程载入"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&title=模块联邦 远程载入"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&title=模块联邦 远程载入"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&title=模块联邦 远程载入"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&name=模块联邦 远程载入&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&t=模块联邦 远程载入"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E4%BB%80%E4%B9%88%E6%98%AF%E8%81%94%E9%82%A6%E6%A8%A1%E5%9D%97%EF%BC%88Module-Federation%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">一.什么是联邦模块（Module Federation）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E5%A6%82%E4%BD%95%E7%94%A8%E8%81%94%E9%82%A6%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E8%B7%A8%E5%BA%94%E7%94%A8%E7%9A%84%E4%BB%A3%E7%A0%81%E5%85%B1%E4%BA%AB"><span class="toc-number">1.2.</span> <span class="toc-text">二.如何用联邦模块实现跨应用的代码共享</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5%E8%BF%9C%E7%A8%8B%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.1.</span> <span class="toc-text">动态导入远程模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%AF%BC%E5%85%A5%E8%BF%9C%E7%A8%8B%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.2.</span> <span class="toc-text">静态导入远程模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E9%82%A6%E6%A8%A1%E5%9D%97%E7%9A%84%E4%B8%89%E4%B8%AA%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.3.</span> <span class="toc-text">联邦模块的三个主要功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E8%81%94%E9%82%A6%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">三.联邦模块的原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack%E6%89%93%E5%8C%85%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">webpack打包原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack%E6%9E%84%E5%BB%BA%E8%B5%84%E6%BA%90"><span class="toc-number">1.3.2.</span> <span class="toc-text">webpack构建资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.3.</span> <span class="toc-text">webpack单文件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack%E5%A4%9A%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.4.</span> <span class="toc-text">webpack多文件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModuleFederationPlugin-%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">1.3.5.</span> <span class="toc-text">ModuleFederationPlugin 的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModuleFederationPlugin-%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.6.</span> <span class="toc-text">ModuleFederationPlugin 的原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SharePlugin"><span class="toc-number">1.3.7.</span> <span class="toc-text">SharePlugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ContainerPlugin"><span class="toc-number">1.3.8.</span> <span class="toc-text">ContainerPlugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ContainerReferencePlugin"><span class="toc-number">1.3.9.</span> <span class="toc-text">ContainerReferencePlugin</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        模块联邦 远程载入
    </h1>



    <div class="meta">
      <!-- <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Liu</span>
      </span> -->
      
    <div class="postdate">
      
        <time datetime="2024-06-15T11:25:25.000Z" itemprop="datePublished">2024-06-15</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/MicroFrontend/" rel="tag">MicroFrontend</a>, <a class="tag-link-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%85%A8%E6%A0%88/" rel="tag">前端全栈</a>, <a class="tag-link-link" href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" rel="tag">微前端</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>当项目A需要共享项目B的某一个组件，并需要保证后续的迭代中，两边保持一致。这个时候有两种做法：</p>
<p>CV 大法，将项目B的组件完整复制到项目A<br>将该组件独立，发布到内部npm，通过npm加载组件</p>
<p>CV 大法比独立组件更快，不需要将组件从项目B独立出来，发布npm，但不能及时同步代码。<br>当两个项目都使用了Webpack5，通过联邦模块只需要几行配置就可以实现在项目A同步项目B的组件。</p>
<h2 id="一-什么是联邦模块（Module-Federation）"><a href="#一-什么是联邦模块（Module-Federation）" class="headerlink" title="一.什么是联邦模块（Module Federation）"></a>一.什么是联邦模块（Module Federation）</h2><blockquote>
<p>联邦模块是webpack5提供的一个新特性，它是通过webpack原生提供的 <code>ModuleFederationPlugin</code> 插件来实现的。<br>联邦模块主要是用来解决多个应用之间代码共享的问题，可以让我们的更加优雅的实现跨应用的代码共享</p>
</blockquote>
<p>联邦模块出现的动机通常认为是为了解决微前端全栈中不能在多个子应用间共享资源的问题，但联邦模块出现后又并不仅仅局限于微前端。<br>模块联邦允许多个<code>webpack</code>构建一起工作。从运行时的角度来看，多个构建的模块将表现得像一个巨大的连接模块图。从开发者的角度来看，模块可以从指定的远程构建中导入，并以最小的限制来使用。使<code>JavaScript</code>应用得以在客户端或服务器上动态运行或者动态加载另一个<code>bundle.js</code>或者<code>build</code>之后生成的代码，且共享依赖。</p>
<p>通过 <code>Module Federation</code>实现的代码共享是双向的，但每种情况都有降级方案。<code>Module federated</code>可以总是加载自己的依赖，但在下载前会去尝试使用消费者的依赖。更少的代码冗余，依赖共享就像一个单一的<code>Webpack</code>构建。</p>
<h2 id="二-如何用联邦模块实现跨应用的代码共享"><a href="#二-如何用联邦模块实现跨应用的代码共享" class="headerlink" title="二.如何用联邦模块实现跨应用的代码共享"></a>二.如何用联邦模块实现跨应用的代码共享</h2><h3 id="动态导入远程模块"><a href="#动态导入远程模块" class="headerlink" title="动态导入远程模块"></a><u>动态导入远程模块</u></h3><blockquote>
<p>当远程项目不能固定写在webpack配置中时，可以通过动态导入的方式使用联邦模块</p>
</blockquote>
<p>动态导入和静态导入的区别在于，需要自己实现js加载和容器连接</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// host</span></span><br><span class="line"><span class="comment">// 加载js标签</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadScript</span>(<span class="params">src</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> srcirpt = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">      script.<span class="property">src</span> = src;</span><br><span class="line">      script.<span class="property">onload</span> = res;</span><br><span class="line">      script.<span class="property">onfaild</span> = rej</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接容器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadComponent</span>(<span class="params">scope, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="comment">// 初始化共享作用域（shared scope）用提供的已知此构建和所有远程的模块填充它</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">__webpack_init_sharing__</span>(<span class="string">&#x27;default&#x27;</span>);</span><br><span class="line">      <span class="keyword">const</span> container = <span class="variable language_">window</span>[scope]; <span class="comment">// 或从其他地方获取容器</span></span><br><span class="line">      <span class="comment">// 初始化容器 它可能提供共享模块</span></span><br><span class="line">      <span class="keyword">await</span> container.<span class="title function_">init</span>(__webpack_share_scopes__.<span class="property">default</span>);</span><br><span class="line">      <span class="keyword">const</span> factory = <span class="keyword">await</span> <span class="variable language_">window</span>[scope].<span class="title function_">get</span>(<span class="variable language_">module</span>);</span><br><span class="line">      <span class="keyword">const</span> <span class="title class_">Module</span> = <span class="title function_">factory</span>();</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Module</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载远程模块的入口文件并并连接</span></span><br><span class="line"><span class="title function_">loadScript</span>(<span class="string">&#x27;http://localhost:3001/remote-entry.js&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">loadComponent</span>(<span class="string">&#x27;app&#x27;</span>, <span class="string">&#x27;button&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">module</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">module</span>)</span><br><span class="line">  &#125;);    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// remote</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;app&quot;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;remote-entry.js&#x27;</span>,</span><br><span class="line">      <span class="attr">exposes</span>: &#123;</span><br><span class="line">          <span class="string">&quot;button&quot;</span>: <span class="string">&quot;./src/button.js&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">  &#125;)]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://github.com/Bxiaoyao/dynamic-remotes">动态导入远程模块demo地址</a></p>
<h3 id="静态导入远程模块"><a href="#静态导入远程模块" class="headerlink" title="静态导入远程模块"></a><u>静态导入远程模块</u></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// host</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;host&quot;</span>,</span><br><span class="line">      <span class="attr">remotes</span>: &#123;</span><br><span class="line">          <span class="string">&quot;app&quot;</span>: <span class="string">&quot;app@http://localhost:3001/remote-entry.js&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">shared</span>: &#123;</span><br><span class="line">          <span class="attr">react</span>: &#123;</span><br><span class="line">              <span class="attr">eager</span>: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// remote</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;app&quot;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;remote-entry.js&#x27;</span>,</span><br><span class="line">      <span class="attr">exposes</span>: &#123;</span><br><span class="line">          <span class="string">&quot;button&quot;</span>: <span class="string">&quot;./src/button.js&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">shared</span>: [<span class="string">&#x27;react&#x27;</span>]</span><br><span class="line">  &#125;)]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://github.com/Bxiaoyao/static-remotes">静态导入远程模块demo地址</a></p>
<h3 id="联邦模块的三个主要功能"><a href="#联邦模块的三个主要功能" class="headerlink" title="联邦模块的三个主要功能"></a><u>联邦模块的三个主要功能</u></h3><ul>
<li>remotes 用来声明会引用哪些远程文件，以及从哪里来导入远程资源</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在此项配置中，会从远程的 http://localhost:3000/app-entry.js 读取文件来加载 app 模块</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;template&quot;</span>,</span><br><span class="line">    <span class="attr">remotes</span>: &#123;</span><br><span class="line">        <span class="attr">app</span>: <span class="string">&quot;http://localhost:3000/app-entry.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>exposes 用来声明会提供哪些资源供远程使用</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此项配置会相当于建立一个新的entry入口从 ./src/button.js 文件开始进行打包生产新的资源</span></span><br><span class="line"><span class="comment">// Tips: </span></span><br><span class="line"><span class="comment">//   从这个entry打包的资源不会与webpack主入口的资源共享内容。即两个入口都引用了react的话，react会在两个项目中分别存在</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;template&quot;</span>,</span><br><span class="line">    <span class="attr">exposes</span>: &#123;</span><br><span class="line">        <span class="attr">button</span>: <span class="string">&quot;./src/button.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>shared</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 什么哪些模块会在主项目和远程项目中共享</span></span><br><span class="line"><span class="comment">// - 例如：当主项目提供了react的话，远程项目则会直接使用主项目的react模块，而不会再次从远程加载（远程项目的react会单独打包）</span></span><br><span class="line"><span class="comment">// - 主项目的shared集合需要包含远程项目的shared</span></span><br><span class="line"><span class="comment">// - eager: 是否立即加载模块而不是异步加载。如果在主项目的入口文件中依赖了这个模块就必须设置eager，否则报错</span></span><br><span class="line"><span class="comment">// - singleton: 是否确保使用单例模式</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;template&quot;</span>,</span><br><span class="line">    <span class="attr">shared</span>: &#123;</span><br><span class="line">        <span class="attr">react</span>: &#123;</span><br><span class="line">            <span class="attr">eager</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>如果想看更多关于联邦模块的案例，可以访问<a href="https://link.juejin.cn/?target=https://github.com/module-federation/module-federation-examples">官方仓库</a>。</p>
<h2 id="三-联邦模块的原理分析"><a href="#三-联邦模块的原理分析" class="headerlink" title="三.联邦模块的原理分析"></a>三.联邦模块的原理分析</h2><p>联邦模块是通过webpack原生提供的<code>ModuleFederationPlugin</code>插件来实现的，它有两个主要概念：Host（消费其他 Remote）和Remote（被 Host 消费）。每个项目可以是Host也可以是Remote，也可以两个都是。</p>
<ul>
<li>作为Host需要配置remote列表和shared模块。</li>
<li>作为Remote需要配置项目名（name），打包方式（library），打包后的文件名（filename），提供的模块（exposes），和Host共享的模块（shared）。</li>
</ul>
<h3 id="webpack打包原理"><a href="#webpack打包原理" class="headerlink" title="webpack打包原理"></a><u>webpack打包原理</u></h3><p>联邦模块是基于webpack做的优化，所以在深入联邦模块之前我们首先得知道webpack是怎么做的打包工作。</p>
<p>通过阅读webpack打包结果可以了解到，webpack每次打包都会将资源全部包裹在一个立即执行函数里面，这样虽然避免了全局环境的污染，但也使得外部不能访问内部模块。</p>
<p>在这个立即执行函数里面，webpack使用 <code>__webpack_modules__</code> 对象保存所有的模块代码，然后用内部定义的__webpack_require__ 方法从 <code>__webpack_modules__</code> 中加载模块。并且在异步加载和文件拆分两种情况下向全局暴露一个 webpackChunk 数组用于沟通多个webpack资源，这个数组通过被webpack重写push方法，会在其他资源向webpackChunk 数组中新增内容时同步添加到 <code>__webpack_modules__</code>  中从而实现模块整合。</p>
<p>联邦模块就是基于这个机制，修改了 <code>__webpack_require__</code>  的部分实现，在require的时候从远程加载资源，然后合并到<code>__webpack_modules__</code> 中。</p>
<p><strong>Tips：</strong></p>
<ul>
<li>webpackChunk 可以通过 output.chunkLoadingGlobal 配置修改</li>
</ul>
<h3 id="webpack构建资源"><a href="#webpack构建资源" class="headerlink" title="webpack构建资源"></a>webpack构建资源</h3><p>JS的模块化机制有许多的标准，不过在webpack中全部统一转化为自己实现的<code>__webpack_require__</code></p>
<h3 id="webpack单文件结构"><a href="#webpack单文件结构" class="headerlink" title="webpack单文件结构"></a>webpack单文件结构</h3><p>在webpack单文件结构中，所有模块的源码都存储在 <code>__webpack_modules__</code> 对象中，然后都统一使用内部定义的 <code>__webpack_require__</code> 方法来加载模块。</p>
<p>在这种情况下，外部完全无法访问内部的运行资源</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> __webpack_modules__ = &#123;</span><br><span class="line">        <span class="string">&#x27;./src/other.js&#x27;</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// ...</span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> __webpack_module_cache__ = &#123;&#125; <span class="comment">// 模块导出结果的缓存</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">__webpack_require__</span>(<span class="params"></span>) &#123;  <span class="comment">// 内部模块导入方法</span></span><br><span class="line">    	<span class="comment">// .....</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// .....</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 入口文件内容</span></span><br><span class="line">    (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">__webpack_require__</span>(<span class="string">&#x27;./src/other.js&#x27;</span>)</span><br><span class="line">    &#125;)()</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h3 id="webpack多文件结构"><a href="#webpack多文件结构" class="headerlink" title="webpack多文件结构"></a>webpack多文件结构</h3><p>在多文件结构中，存在两个地方存储模块源码，一个是内部的 <code>__webpack_modules__</code> 对象，另一个是全局的 <code>webpackChunk</code> 数组。</p>
<p>webpackChunk 数组其实是起一个桥梁作用，用于将其他文件中的模块加载到入口文件的 <code>__webpack_modules__</code> 对象中，而这是通过重写 webpackChunk数组的push方法实现的。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> __webpack_modules__ = &#123;</span><br><span class="line">        <span class="string">&#x27;./src/other.js&#x27;</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// 源码</span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> __webpack_module_cache__ = &#123;&#125; <span class="comment">// 模块导出结果的缓存</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">__webpack_require__</span>(<span class="params"></span>) &#123;&#125; <span class="comment">// 内部模块导入方法</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 向全局暴露出一个对象</span></span><br><span class="line">    self[<span class="string">&quot;webpackChunk&quot;</span>].<span class="property">push</span> = webpackJsonpCallback.<span class="title function_">bind</span>(<span class="literal">null</span>, chunkLoadingGlobal.<span class="property">push</span>.<span class="title function_">bind</span>(chunkLoadingGlobal));</span><br><span class="line">    <span class="comment">// 入口文件内容</span></span><br><span class="line">    (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">__webpack_require__</span>(<span class="string">&#x27;./src/other.js&#x27;</span>)</span><br><span class="line">    &#125;)()</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/other2.js</span></span><br><span class="line">(self[<span class="string">&quot;webpackChunk&quot;</span>] = self[<span class="string">&quot;webpackChunk&quot;</span>] || []).<span class="title function_">push</span>([</span><br><span class="line">  [<span class="string">&quot;src_other2_js&quot;</span>],</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;./src/other2.js&quot;</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;in other2.js&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="ModuleFederationPlugin-的用法"><a href="#ModuleFederationPlugin-的用法" class="headerlink" title="ModuleFederationPlugin 的用法"></a><u>ModuleFederationPlugin 的用法</u></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;app1&quot;</span>,</span><br><span class="line">  <span class="attr">library</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;var&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;app1&quot;</span> &#125;,</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;remoteEntry.js&quot;</span>,</span><br><span class="line">  <span class="attr">remotes</span>: &#123;</span><br><span class="line">    <span class="attr">app2</span>: <span class="string">&#x27;app2&#x27;</span>,</span><br><span class="line">    <span class="attr">app3</span>: <span class="string">&#x27;app3&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">remoteType</span>: <span class="string">&#x27;var&#x27;</span>,</span><br><span class="line">  <span class="attr">exposes</span>: &#123;</span><br><span class="line">    <span class="attr">antd</span>: <span class="string">&#x27;./src/antd&#x27;</span>,</span><br><span class="line">    <span class="attr">button</span>: <span class="string">&#x27;./src/button&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">shared</span>: [<span class="string">&#x27;react&#x27;</span>, <span class="string">&#x27;react-dom&#x27;</span>],</span><br><span class="line">  <span class="attr">shareScope</span>: <span class="string">&#x27;default&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>配置属性：</p>
<ul>
<li>name: 必须，唯一 ID，作为输出的模块名（容器），使用的时通过 name&#x2F;{name}&#x2F;name&#x2F;{expose} 的方式使用；</li>
<li>library: 可选，打包方式，默认{ type: “var”, name: options.name }，其中这里的 name 为作为 umd 的 name，是挂载在全局下的变量名；</li>
<li>filename: 可选，打包后的文件名；</li>
<li>remotes: 可选，表示当前应用是一个 Host，可以引用 Remote 中 expose 的模块；</li>
<li>remoteType: 可选，默认var，(“var”|”module”| “assign”|”this”|”window”|”self”|”global”|”commonjs”|”commonjs2”| “commonjs-module”|”amd”|”amd-require”|”umd”|”umd2”|”jsonp”|”system”|”promise”|”import”|”script”)，远程容器的外部类型；</li>
<li>exposes:可选，表示当前应用是一个 Remote，exposes 内的模块可以被其他的 Host 引用，引用方式为 import(name&#x2F;{name}&#x2F;name&#x2F;{expose})；</li>
<li>shared: 可选，主要是用来避免项目出现多个公共依赖，若是配置了这个属性，webpack在加载的时候会先判断本地应用是否存在对应的包，若是不存在，则加载远程应用的依赖包；</li>
<li>shareScope，可选，用于所有共享模块的共享作用域名称</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 公共依赖shared的配置项</span></span><br><span class="line"><span class="title class_">Shared</span> = <span class="built_in">string</span>[] | &#123;</span><br><span class="line">  [<span class="built_in">string</span>]: &#123;</span><br><span class="line">    eager?: <span class="built_in">boolean</span>; <span class="comment">// 是否立即加载模块而不是异步加载</span></span><br><span class="line">    <span class="keyword">import</span>?: <span class="literal">false</span> | <span class="title class_">SharedItem</span>; <span class="comment">// 应该提供给共享作用域的模块。如果在共享范围中没有发现共享模块或版本无效，还充当回退模块。默认为属性名</span></span><br><span class="line">    packageName?: <span class="built_in">string</span>; <span class="comment">// 设置包名称以查找所需的版本。只有当包名不能根据请求自动确定时，才需要这样做（如要禁用自动推断，请将requiredVersion设置为false）。</span></span><br><span class="line">    requiredVersion?: <span class="literal">false</span> | <span class="built_in">string</span>; <span class="comment">// 共享范围内模块的版本要求</span></span><br><span class="line">    shareKey?: <span class="built_in">string</span>; <span class="comment">// 用这个名称在共享范围中查找模块</span></span><br><span class="line">    shareScope?: <span class="built_in">string</span>; <span class="comment">// 共享范围名称</span></span><br><span class="line">    singleton?: <span class="built_in">boolean</span>; <span class="comment">// 是否在共享作用域中只允许共享模块的一个版本 (单例模式).</span></span><br><span class="line">    strictVersion?: <span class="built_in">boolean</span>; <span class="comment">// 如果版本无效则不接受共享模块(默认为true，如果本地回退模块可用且共享模块不是一个单例，否则为false，如果没有指定所需的版本则无效)</span></span><br><span class="line">    version?: <span class="literal">false</span> | <span class="built_in">string</span>; <span class="comment">// 所提供模块的版本，将替换较低的匹配版本</span></span><br><span class="line">  &#125;[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Tips：</strong></p>
<ul>
<li>在使用 Module Federation 的时候一定要记得，将公共依赖配置到 shared 中。另外，一定要两个项目同时配置 shared ，否则会报错</li>
<li>入口文件index.js本身应该没有什么逻辑，将逻辑放在bootstrap.js中，index.js去动态加载bootstrap.js。如果将逻辑直接放到index.js里，会报错，如果是公共依赖配置shared报错，可以配eager参数来解决。主要原因是如果直接在index.js执行逻辑，会依赖Remote暴露的js，此时remote.js还没有加载，就会有问题。</li>
</ul>
<h3 id="ModuleFederationPlugin-的原理"><a href="#ModuleFederationPlugin-的原理" class="headerlink" title="ModuleFederationPlugin 的原理"></a><u>ModuleFederationPlugin 的原理</u></h3><p><code>ModuleFederationPlugin</code>主要做了三件事：</p>
<ul>
<li>如何共享依赖：使用 SharePlugin</li>
<li>如何公开模块：使用 ContainerPlugin</li>
<li>如何引用模块：使用 ContainerReferencePlugin</li>
</ul>
<h3 id="SharePlugin"><a href="#SharePlugin" class="headerlink" title="SharePlugin"></a>SharePlugin</h3><p>该插件使公共依赖可共享</p>
<h3 id="ContainerPlugin"><a href="#ContainerPlugin" class="headerlink" title="ContainerPlugin"></a>ContainerPlugin</h3><p>该插件为指定的公开模块创建entry。entry.js执行后会在window上挂一下对象，该对象有两个方法，get和init。get方法用来获取模块。init方法用来初始化容器，它可以提供共享模块。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry.js</span></span><br><span class="line"><span class="keyword">var</span> remote;remote = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// remote对象里的get和init方法</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">get</span> = (<span class="params"><span class="variable language_">module</span>, getScope</span>) =&gt; &#123;</span><br><span class="line">	__webpack_require__.<span class="property">R</span> = getScope;</span><br><span class="line">	getScope = (</span><br><span class="line">		__webpack_require__.<span class="title function_">o</span>(moduleMap, <span class="variable language_">module</span>)</span><br><span class="line">			? moduleMap[<span class="variable language_">module</span>]()</span><br><span class="line">			: <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Module &quot;&#x27;</span> + <span class="variable language_">module</span> + <span class="string">&#x27;&quot; does not exist in container.&#x27;</span>);</span><br><span class="line">			&#125;)</span><br><span class="line">	);</span><br><span class="line">	__webpack_require__.<span class="property">R</span> = <span class="literal">undefined</span>;</span><br><span class="line">	<span class="keyword">return</span> getScope;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> <span class="title function_">init</span> = (<span class="params">shareScope, initScope</span>) =&gt; &#123;</span><br><span class="line">	<span class="keyword">if</span> (!__webpack_require__.<span class="property">S</span>) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">var</span> oldScope = __webpack_require__.<span class="property">S</span>[<span class="string">&quot;default&quot;</span>];</span><br><span class="line">	<span class="keyword">var</span> name = <span class="string">&quot;default&quot;</span></span><br><span class="line">	<span class="keyword">if</span>(oldScope &amp;&amp; oldScope !== shareScope) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Container initialization failed as it has already been initialized with a different share scope&quot;</span>);</span><br><span class="line">	__webpack_require__.<span class="property">S</span>[name] = shareScope;</span><br><span class="line">	<span class="keyword">return</span> __webpack_require__.<span class="title function_">I</span>(name, initScope);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This exports getters to disallow modifications</span></span><br><span class="line">__webpack_require__.<span class="title function_">d</span>(<span class="built_in">exports</span>, &#123;</span><br><span class="line">	<span class="attr">get</span>: <span class="function">() =&gt;</span> get,</span><br><span class="line">	<span class="attr">init</span>: <span class="function">() =&gt;</span> init</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p>在使用Remote的模块时候，通过init将自身shared写入Remote中，再通过get获取Remote中expose的组件，而作为Remote时，判断Host中是否有可用的共享依赖，若有，则加载Host的这部分依赖，若无，则加载自身依赖。</p>
<h3 id="ContainerReferencePlugin"><a href="#ContainerReferencePlugin" class="headerlink" title="ContainerReferencePlugin"></a>ContainerReferencePlugin</h3><p>该插件将特定的引用添加到作为外部资源（externals）的容器中，并允许从这些容器中导入远程模块。在导入时会调用容器使用者提供的remote进行重载。</p>
<blockquote>
<p>通过remotes定义的模块，也会在 <strong>webpack_modules</strong> 中声明但不会有具体实现，这就和异步导入类似。<br>webpack5中新增了__webpack_require__.e 方法，对通过次方法导入的模块执行一下三个函数，并且全部成功才返回。</p>
<ul>
<li><strong>webpack_require</strong>.f.consumes 用来判断和消费shared模块，如果当前环境下已经有这个模块就不向远程请求</li>
<li><strong>webpack_require</strong>.f.remotes 用来连接容器</li>
<li><strong>webpack_require</strong>.f.j 用来加载JS</li>
</ul>
</blockquote>
<p>四.使用场景</p>
<ol>
<li><p>适用于新建专门的组件应用服务来管理全部组件和应用，其余业务层只须要根据本身业务所需载入对应的组件和功能模块便可</p>
</li>
<li><p>模块管理统一管理，代码质量高，搭建速度快。适用于矩阵app，或者可视化页面搭建等场景</p>
</li>
</ol>
<p>参考文章</p>
<p><a href="https://link.juejin.cn/?target=https://webpack.docschina.org/concepts/module-federation/">webpack 5 官方文档</a></p>
<p><a href="https://link.juejin.cn/?target=https://segmentfault.com/a/1190000024449390">Webpack5 跨应用代码共享 - Module Federation</a></p>
<p><a href="https://link.juejin.cn/?target=https://zhuanlan.zhihu.com/p/141390589">尝试webpack5 Module Federation</a></p>
<p><a href="https://link.juejin.cn/?target=https://blog.csdn.net/yingyangxing/article/details/109653116">探索 webpack5 新特性 Module federation 引发的javascript共享模块变革</a></p>
<p><a href="https://link.juejin.cn/?target=https://developer.aliyun.com/article/755252">三大应用场景调研，Webpack 新功能 Module Federation 深入解析</a></p>

  </div>
</article>

    <div class="blog-post-comments">
        
        
            <div class="vcomment"></div>
        
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/codcer">Github</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E4%BB%80%E4%B9%88%E6%98%AF%E8%81%94%E9%82%A6%E6%A8%A1%E5%9D%97%EF%BC%88Module-Federation%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">一.什么是联邦模块（Module Federation）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E5%A6%82%E4%BD%95%E7%94%A8%E8%81%94%E9%82%A6%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E8%B7%A8%E5%BA%94%E7%94%A8%E7%9A%84%E4%BB%A3%E7%A0%81%E5%85%B1%E4%BA%AB"><span class="toc-number">1.2.</span> <span class="toc-text">二.如何用联邦模块实现跨应用的代码共享</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5%E8%BF%9C%E7%A8%8B%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.1.</span> <span class="toc-text">动态导入远程模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%AF%BC%E5%85%A5%E8%BF%9C%E7%A8%8B%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.2.</span> <span class="toc-text">静态导入远程模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E9%82%A6%E6%A8%A1%E5%9D%97%E7%9A%84%E4%B8%89%E4%B8%AA%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.3.</span> <span class="toc-text">联邦模块的三个主要功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E8%81%94%E9%82%A6%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">三.联邦模块的原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack%E6%89%93%E5%8C%85%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">webpack打包原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack%E6%9E%84%E5%BB%BA%E8%B5%84%E6%BA%90"><span class="toc-number">1.3.2.</span> <span class="toc-text">webpack构建资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.3.</span> <span class="toc-text">webpack单文件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack%E5%A4%9A%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.4.</span> <span class="toc-text">webpack多文件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModuleFederationPlugin-%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">1.3.5.</span> <span class="toc-text">ModuleFederationPlugin 的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ModuleFederationPlugin-%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.6.</span> <span class="toc-text">ModuleFederationPlugin 的原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SharePlugin"><span class="toc-number">1.3.7.</span> <span class="toc-text">SharePlugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ContainerPlugin"><span class="toc-number">1.3.8.</span> <span class="toc-text">ContainerPlugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ContainerReferencePlugin"><span class="toc-number">1.3.9.</span> <span class="toc-text">ContainerReferencePlugin</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&text=模块联邦 远程载入"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&title=模块联邦 远程载入"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&is_video=false&description=模块联邦 远程载入"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=模块联邦 远程载入&body=Check out this article: https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&title=模块联邦 远程载入"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&title=模块联邦 远程载入"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&title=模块联邦 远程载入"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&title=模块联邦 远程载入"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&name=模块联邦 远程载入&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://codcer.github.io/2024/06/15/MicroFrontend/module-federation/&t=模块联邦 远程载入"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2024
    Codcer
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/codcer">Github</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->


<!-- Valine Comments -->

  
<script src="/js/av-min.js"></script>

  
<script src="/js/Valine.min.js"></script>

  <script type="text/javascript">
      var notify = 'false' == true ? true : false;
      var verify = 'false' == true ? true : false;
      var GUEST_INFO = ['nick','mail','link'];
      var guest_info = 'nick,mail,link'.split(',').filter(function(item){
        return GUEST_INFO.indexOf(item) > -1
      });
      guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
      new Valine({
          el: '.vcomment',
          notify: notify,
          verify: verify,
          appId: "nRach5vXbSulMeiRHgqCbUCT-gzGzoHsz",
          appKey: "CK2vLdlylRq40EiH2lu4lU2H",
          avatar:"mm",
          placeholder: "说点什么",
          guest_info:guest_info,
          pageSize:"10"
      })
  </script>


<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
